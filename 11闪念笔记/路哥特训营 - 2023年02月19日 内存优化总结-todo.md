日期： 2023-02-19

标签： #学习笔记 #技术

学习资料： 
[视频回放](https://pan.baidu.com/play/video#/video?path=%2F%E5%AD%A6%E4%B9%A0%2F%E8%B7%AF%E5%93%A5%E7%89%B9%E8%AE%AD%E8%90%A5%2F2023-02-19_Koom%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%E5%92%8C%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93.mp4&t=-1)

---
<br>

Heap Dump
- Thread Stacks and Local Variables：栈回溯
Reachability
Shallow vs. Retained Heap
- Shallow heap
- Retained set
- Retained heep：即将被gc回收释放
Dominator Tree
Garbadge Collection Root

Koom给我们的总结和反思
- OOMTracker、FdOOMTracker、HeapOOMTracker、PhysicalMemoryOOMTracker、FastHugeMemoryOOMTracker、ThreadOOMTracker
- 为什么Dump需要在子进程，而非子线程？ForkjvmHeapDumper.java
- runtime/debugger.cc
- nm -a 

Bitmap优化
- 链路回收（统一图片库收敛、控制）
- 大图的监控、重复突破

内存的监控
- java内存（systarce、LeakCanary、MAT）
- Native内存
- OOM监控（Koom）

架构优化
- APM 
- 缓存机制（ComponetCallbacks2）
- 减少进程（空进程=10M）
- so的优化（自己写的so文件，编译时-finstrument-functions，解决内存泄漏问题）

核心指标
- 异常率：PSS超过400M次数 / 采集次数
- 触顶率：Java内存使用情况
- GC：getGloableAllocCount、getGloableAllocSize、getRuntimeStat("art.gc.gc-count") gc次数
- 内存事件：onTrimMemory()

GitHub：memory-leak-detector