日期： 2022-04-03

标签： #学习笔记 #技术  #Android 

学习源： 
腾讯课堂 - https://ke.qq.com/webcourse/347420/103755197#taid=12286784742706460&vid=387702296036454930

百度网盘 - https://pan.baidu.com/disk/main?from=homeFlow&_at_=1648737764421#/index?category=all&path=%2F%E5%AD%A6%E4%B9%A0%2F%E4%BA%AB%E5%AD%A6VIP%E8%AF%BE%E7%A8%8B%2F3%E6%9C%9F%2F%E3%80%9006%E3%80%91%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%2F%EF%BC%8808%EF%BC%892022.2.13-%E5%8D%A1%E9%A1%BF%E7%9B%91%E6%B5%8B%26%E5%B8%83%E5%B1%80%E4%BC%98%E5%8C%96---%E8%B7%AF%E5%93%A5

---
<br>

## 渲染流图
![[Screenshot_20220403_230618_cn.wps.moffice_eng_edit_4391195058704.jpg|600]]
- GPU：着色器、片元


## Systrace
- 本质是脚本，用 python 调用 Linux 的 run_systrace 工具。视频10:34开讲
- 推荐用 Perfetto：Open trace file 新版本、Open with legacy UI 老版systrace
- 各种参数，可参见官方文档
	- UI相关：gfx、input、wm、view、webview
	- 运行时：freq、idle、sched
- 信息关注
	- process选项：SurfaceFlinger进程、本App进程
	- Alert，几大分类
	- Frame —— UI Thread、RenderThread 两个线程；点击查看黄、红色的 F 图标
	- animator
-  Application.onCreate() 调用开始，Activity.onWindowFacusChanged() 调用结束：Trace.beginSection()、Trace.endSection()
- Fragment执行bigin、end事务
- release包，反射调用 android.os.Trace 的 setAppTracingAllowed() 方法

## 线上监控
- 使用并学习 **blockcanary框架**
- 原理：消息机制
	- Looper.setMessageLogging(Printer printer);
	- LooperMonitor.println()
	- 记录方法栈：LooperMonitor.startDump() -> StackSample.doSample() -> Thread.getStackTrace() -> StackTraceElement.toString()
	- 记录CPU：LooperMonitor.startDump() -> CpuSampler.doSample() -> 